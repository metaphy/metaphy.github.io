---
layout: post
title: "神奇的SQL"
date: 2022-12-10 11:25:00 +0800
categories: SQL
--- 
SQL绝对被人低估了，至少被我低估了。SQL是那种你可以投入少量时间却能获得较大收益的技术，也就是说边际效用极大。SQL具有很强的稳定性，尽管随着时间的推移有不少新的版本发布，但是基本功能几乎没怎么变化，两个主要版本SQL92和SQL99距今都二三十年了。SQL的稳定性能够让你一次性投入而长时间获得收益，相比某些前端技术或某些短命的框架而言，简直是一本万利的买卖。SQL又具有一定的难度，对于某些复杂操作，或者某些常见的坑（比如三值逻辑运算），不经过一定时间的学习，很难轻松掌握和面对。

如果把编程范式粗略地划分成命令式和函数式的话，SQL应该归于函数式这一类；但SQL处理的对象是集合，其数学基础是关系代数和集合论。这一点让SQL跟其他语言非常不同，你没法从其他编程经验中直接获得SQL的编写经验，也就是说，SQL是编程世界中比较特立独行的一个分支，需要花费时间认真对待。

下面以例子解释SQL的编写，主要参考日本作者Mick的《SQL进阶教程（第2版）》，一个容易被人看不上的非常土的书名，但其实内容极好，豆瓣9.1评分。下面的所有例子和SQL均在MySQL8上执行验证过。

[例1]有一城市人口表如下：
```
DROP TABLE IF EXISTS dec_popu;
CREATE TABLE dec_popu (
  id INT PRIMARY KEY AUTO_INCREMENT,
  city VARCHAR (64) NOT NULL,
  gender VARCHAR(1) NOT NULL DEFAULT 'M',
  population INT NOT NULL DEFAULT 0
);

INSERT INTO dec_popu(city, gender, population) VALUES('贵阳市', 'M' , 26714);
INSERT INTO dec_popu(city, gender, population) VALUES('贵阳市', 'F' , 23134);
INSERT INTO dec_popu(city, gender, population) VALUES('六枝特区', 'M' , 3026);
INSERT INTO dec_popu(city, gender, population) VALUES('六枝特区', 'F' , 2926);
INSERT INTO dec_popu(city, gender, population) VALUES('德州市', 'M' , 23256);
INSERT INTO dec_popu(city, gender, population) VALUES('青岛市', 'M' , 24770);
INSERT INTO dec_popu(city, gender, population) VALUES('潍坊市', 'M' , 32005);
INSERT INTO dec_popu(city, gender, population) VALUES('潍坊市', 'F' , 12000);
INSERT INTO dec_popu(city, gender, population) VALUES('乐山市', 'M' , 19200);
INSERT INTO dec_popu(city, gender, population) VALUES('乐山市', 'F' , 10800);
```
要求：虽然表格中并没有省份信息，但是需要按照省份统计总人口。省份作为一种常识存在。这里练习使用CASE子句。

```
SELECT CASE
  WHEN city in ('贵阳市','六枝特区') THEN '贵州'
  WHEN city in ('德州市','青岛市','潍坊市' ) THEN '山东'
  WHEN city in ('乐山市') THEN '四川'
  ELSE '未知'
  END AS province,
  SUM(population) AS Total
FROM dec_popu
GROUP BY province;
```

要求：以城市/男性人口/女性人口的格式统计数据。这里练习把CASE放到SUM函数中。

```
SELECT city,
  SUM(CASE WHEN gender = 'M' THEN population ELSE 0 END) AS population_male,
  SUM(CASE WHEN gender = 'F' THEN population ELSE 0 END) AS population_female
FROM dec_popu
GROUP BY city;
```

要求：按性别统计，表格中各性别总人数，山东省各性别总人数，山东省下面各市各性别总人数。

```
SELECT gender
  , SUM(population) AS Total
  , SUM(CASE WHEN city in ('德州市') THEN population ELSE 0 END) AS DeZhouShi
  , SUM(CASE WHEN city in ('青岛市') THEN population ELSE 0 END) AS QingDaoShi
  , SUM(CASE WHEN city in ('潍坊市') THEN population ELSE 0 END) AS WeiFangShi
  , SUM(CASE WHEN city in ('德州市','青岛市','潍坊市') THEN population ELSE 0 END) AS ShanDongSheng
FROM dec_popu
GROUP BY gender;
```

要求：如果城市中只有1种性别的人口记录，那么选它，如果有2种性别的人口记录，那么就选男性的人口数据。这里可以看出CASE子句极大的灵活性。

```
SELECT city, 
  CASE WHEN count(*) = 1 THEN MAX(population) 
  ELSE MAX(CASE WHEN gender = 'M' THEN population ELSE -1 END) END AS PopuMain
FROM dec_popu
GROUP BY city;
```

[例2]下面是课程表以及课程时间表：
```
DROP TABLE IF EXISTS dec_course;
CREATE TABLE dec_course (
  course_id INT PRIMARY KEY AUTO_INCREMENT,
  course_name VARCHAR (32) NOT NULL
);

INSERT INTO dec_course(course_name) VALUES('计算机基础');
INSERT INTO dec_course(course_name) VALUES('会计学');
INSERT INTO dec_course(course_name) VALUES('财务管理学');
INSERT INTO dec_course(course_name) VALUES('英语');

DROP TABLE IF EXISTS dec_course_schedule;
CREATE TABLE dec_course_schedule (
  id INT PRIMARY KEY AUTO_INCREMENT,
  course_id INT NOT NULL,
  schedule_month  VARCHAR(10)
);

INSERT INTO dec_course_schedule(course_id, schedule_month) VALUES(1, '2022-05');
INSERT INTO dec_course_schedule(course_id, schedule_month) VALUES(1, '2022-06');
INSERT INTO dec_course_schedule(course_id, schedule_month) VALUES(1, '2022-07');
INSERT INTO dec_course_schedule(course_id, schedule_month) VALUES(2, '2022-06');
INSERT INTO dec_course_schedule(course_id, schedule_month) VALUES(2, '2022-07');
INSERT INTO dec_course_schedule(course_id, schedule_month) VALUES(3, '2022-05');
INSERT INTO dec_course_schedule(course_id, schedule_month) VALUES(4, '2022-07');
```

要求：把每项课程在每个月是否开课表示出来。这里使用case把课程时间的行信息，转为列信息。
```
SELECT course_id, course_name,
  CASE WHEN course_id in (SELECT course_id FROM dec_course_schedule WHERE schedule_month = '2022-05') THEN 'Yes' ELSE '-' END AS 'May',
  CASE WHEN course_id in (SELECT course_id FROM dec_course_schedule WHERE schedule_month = '2022-06') THEN 'Yes' ELSE '-' END AS 'June',
  CASE WHEN course_id in (SELECT course_id FROM dec_course_schedule WHERE schedule_month = '2022-07') THEN 'Yes' ELSE '-' END AS 'July'
FROM dec_course;
```
另一种实现方式：
```
SELECT c.course_name,
  CASE WHEN EXISTS (SELECT course_id FROM dec_course_schedule cs WHERE c.course_id = cs.course_id AND cs.schedule_month = '2022-05') THEN 'Yes' ELSE '' END AS May,
  CASE WHEN EXISTS (SELECT course_id FROM dec_course_schedule cs WHERE c.course_id = cs.course_id AND cs.schedule_month = '2022-06') THEN 'Yes' ELSE '' END AS June,
  CASE WHEN EXISTS (SELECT course_id FROM dec_course_schedule cs WHERE c.course_id = cs.course_id AND cs.schedule_month = '2022-07') THEN 'Yes' ELSE '' END AS July
FROM dec_course c;
```

[例3]下面是学生与他们多次模拟考试成绩的一个记录表，成绩记录在列中。

```
DROP TABLE IF EXISTS dec_student_scores;
CREATE TABLE dec_student_scores (
  name VARCHAR (16) NOT NULL,
  score1 int,
  score2 int,
  score3 int
);

INSERT INTO dec_student_scores VALUES('sam', 123, 202, 153);
INSERT INTO dec_student_scores VALUES('andy', 251, 185, 132);
INSERT INTO dec_student_scores VALUES('tom', 214, 207, 111);
INSERT INTO dec_student_scores VALUES('judy', 203, 223, 198);
```

要求：找出各个同学的最高分数。这个可以直接使用MySQL支持的GREATEST(score1, score2, score3)函数实现，但我们尝试使用CASE的方式。

```
SELECT name, 
  CASE WHEN score_bigger > score3 THEN score_bigger ELSE score3 END AS max_score 
FROM (
  SELECT name, score3, CASE WHEN score1 > score2 THEN score1 ELSE score2 END AS score_bigger
  FROM dec_student_scores
) tmp;
```
另一种实现方式：
```
SELECT name, 
  CASE WHEN score1 > (CASE WHEN score2 > score3 THEN score2 ELSE score3 END)
  THEN score1
  ELSE (CASE WHEN score2 > score3 THEN score2 ELSE score3 END) END AS max_score
FROM dec_student_scores;
```

要求：将各位同学的成绩以sam, judy, tom, andy的顺序排序。这里练习将CASE子句放到ORDER BY之中。
```
SELECT name, score1, score2, score3
FROM dec_student_scores
ORDER BY (
  CASE name 
    WHEN 'sam' THEN 1
    WHEN 'judy' THEN 2
    WHEN 'tom' THEN 3
    WHEN 'andy' THEN 4
  ELSE NULL 
  END  
);
```

要求：求表中name的笛卡尔积，去除(a, a)这样的元组。使用CROSS JOIN来求笛卡尔积。
```
SELECT A.name AS name1, B.name AS name2
FROM dec_student_scores A  
CROSS JOIN dec_student_scores B
  on A.name <> B.name
order by A.name;
```

更进一步，要求(a, b)和(b, a) 这样的数据，只保留一条。这其实是在找两个元素的排列。
```
SELECT A.name AS name1, B.name AS name2
FROM dec_student_scores A 
INNER JOIN dec_student_scores B
  on A.name < B.name
order by A.name;
```

[例4]下面是各个服务器在某些日期的工作负载。
 
``` 
DROP TABLE IF EXISTS dec_server_loads;
CREATE TABLE dec_server_loads (
  server VARCHAR (4) NOT NULL,
  sample_date date NOT NULL,
  loads int NOT NULL default 0
);

insert into dec_server_loads values ('A', '2022-05-01', 1000);
insert into dec_server_loads values ('A', '2022-05-02', 1200);
insert into dec_server_loads values ('A', '2022-05-03', 1300);
insert into dec_server_loads values ('A', '2022-05-04', 900);
insert into dec_server_loads values ('A', '2022-05-05', 1220);
insert into dec_server_loads values ('B', '2022-05-01', 1100);
insert into dec_server_loads values ('B', '2022-05-02', 1200);
insert into dec_server_loads values ('B', '2022-05-06', 1500);
insert into dec_server_loads values ('B', '2022-05-07', 2000);
insert into dec_server_loads values ('B', '2022-05-12', 1000);
insert into dec_server_loads values ('C', '2022-05-01', 2000);
insert into dec_server_loads values ('C', '2022-05-03', 1300);
insert into dec_server_loads values ('C', '2022-05-04', 1200);
insert into dec_server_loads values ('C', '2022-05-05', 1600);
```

要求：每条记录都有一个日期，如何把这个日期的前一天找出来？这里需要用到Window函数。

```
SELECT server, sample_date,
  MIN(sample_date) OVER (
    PARTITION BY server ORDER BY sample_date ASC 
    ROWS between 1 preceding AND 1 preceding
  ) AS last_date
FROM dec_server_loads;
```

更进一步，把这个日期找出来，并且把这个日期对应的负载数据查出来。这里可以把Window单独定义出来，这样可以在SQL查询中直接使用，保持SQL的简洁。

```
SELECT server, sample_date, loads,
  MIN(sample_date) OVER W AS last_date,
  MIN(loads) OVER W AS last_loads
FROM dec_server_loads
Window W AS (PARTITION BY server ORDER BY sample_date ASC 
  ROWS between 1 preceding AND 1 preceding);
```

[例5]下面是一个产品表，里面包含产品信息和价格信息。
```
DROP TABLE IF EXISTS dec_product;
CREATE TABLE dec_product (
  id INT PRIMARY KEY AUTO_INCREMENT,
  product_name VARCHAR(32) not null,
  price DECIMAL(10,2),
  remarks VARCHAR(32) default ''
);

INSERT INTO dec_product(product_name, price) values('Apple', 7.5);
INSERT INTO dec_product(product_name, price) values('Watermelon', 2);
INSERT INTO dec_product(product_name, price) values('Banana', 5);
INSERT INTO dec_product(product_name, price) values('Apple', 7.5);
INSERT INTO dec_product(product_name, price) values('Apple', 7.5);
INSERT INTO dec_product(product_name, price) values('Banana', 5);
INSERT INTO dec_product(product_name, price) values('Apple', 8);
INSERT INTO dec_product(product_name, price) values('Apple', 8.5);
INSERT INTO dec_product(product_name, price) values('Watermelon', 2.2);
INSERT INTO dec_product(product_name, price) values('Grape', 7.5);
INSERT INTO dec_product(product_name, price) values('Orange', 12);
INSERT INTO dec_product(product_name, price) values('Carrot', 2);
INSERT INTO dec_product(product_name, price) values('Tomato', 1);
INSERT INTO dec_product(product_name, price) values('Cherry', 20);
```

要求：上面表格中有多个重复数据(product_name & price)，选出那些重复的数据，选出id较大的作为重复数据。

```
SELECT * FROM dec_product p1
WHERE id > (
  SELECT MIN(p2.id) 
  FROM dec_product p2 
  WHERE p1.product_name = p2.product_name 
    AND p1.price = p2.price
);
```

要求：选出重复的数据，选出id较大的作为重复数据。练习使用EXCEPT来做集合的减法。

```
SELECT id FROM dec_product
EXCEPT
SELECT MAX(id) FROM dec_product
GROUP BY product_name, price;
```

要求：只要是重复了就选出来，比如有2条数据重复了，把这2条都选出来，而不是像上面那样只选出一条。这里注意EXISTS的用法，EXISTS非常神奇。

```
SELECT * FROM dec_product p1
WHERE EXISTS (
  SELECT 1 FROM (
    SELECT product_name, price, count(*) AS cnt FROM dec_product 
    GROUP BY product_name, price
  ) p2
  WHERE p2.cnt > 1 
    AND p1.product_name = p2.product_name 
    AND p1.price = p2.price
)
order by product_name;
```





------------------- 
 
-- remove duplicated records with Window functions
with rankprd AS (
  SELECT id, product_name, price, rank() over (order by product_name) AS r1
  FROM dec_product
)
delete FROM dec_product WHERE id
in (
  SELECT id FROM (
    SELECT p1.id FROM rankprd p1 WHERE id > (SELECT MIN(id) FROM rankprd p2 WHERE p1.product_name = p2.product_name)
  ) tmp
);

-- find all the records which the same product name while multiple pricing
SELECT distinct p1.id, p1.product_name, p1.price
FROM dec_product p1 INNER JOIN dec_product p2
  on p1.product_name = p2.product_name AND p1.price <> p2.price;

-- Rank the product by price
SELECT product_name, price,
  rank() over (order by price desc) AS r1,
  dense_rank() over (order by price desc) AS r2
FROM dec_product;

-- Rank the product by price without Window
SELECT p1.product_name, p1.price,
  (SELECT count(p2.price) FROM dec_product p2 WHERE p2.price > p1.price) + 1 AS r1,
  (SELECT count(distinct p2.price) FROM dec_product p2 WHERE p2.price > p1.price) + 1 AS r2
FROM dec_product p1
order by r1;

-- Query ShuGuo users which age not covered by WeiGuo's
-- INCORRECT result of the NOT IN ...
SELECT * FROM DEC_USER
WHERE address = 'Shu'
  AND age not in (
    SELECT age FROM DEC_USER
    WHERE address = 'Wei'
  );

-- correct sql
SELECT * FROM DEC_USER u1
WHERE address = 'Shu'
  AND not EXISTS (
    SELECT * FROM DEC_USER u2 WHERE u1.age = u2.age AND u2.address = 'Wei'
  );

--Use order by for the <null> age, the <null> is at top 
SELECT * FROM DEC_USER 
order by age;
/* 
Guojia	<null>
Zhangfei	31
Guanyu	32
Zhangliao	32
Liubei	34
Caocao	35 
*/

-- Hello world
SELECT concat('Hello ', 'world') AS result FROM dual;

-- NULL
SELECT concat('Hello ', NULL) AS result FROM dual;

-- Covert the NULL age to 0
SELECT nickname, COALESCE(age, 0) FROM DEC_USER;

-- Query the person who did not attEND the meeting
SELECT distinct T1.meeting_id, T2.person FROM DEC_MEETING T1
 CROSS JOIN DEC_MEETING T2  
WHERE not EXISTS (
  SELECT 1 FROM  DEC_MEETING T3
  WHERE T1.meeting_id = T3.meeting_id AND T2.person = T3.person
);

-- use Except to Query the person who did not attEND the meeting
SELECT distinct T1.meeting_id, T2.person FROM DEC_MEETING T1
 CROSS JOIN DEC_MEETING T2  
except SELECT meeting_id, person FROM DEC_MEETING;

-- query student_id whose all scores of subjects > 50
SELECT distinct student_id FROM DEC_TEST_SCORES t1
WHERE not EXISTS (
  SELECT 1 FROM DEC_TEST_SCORES t2
  WHERE t1.student_id = t2.student_id AND t2.score < 50
);

-- student who must have scores on Math AND Chinese, AND Math score >= 80 AND Chinese score >=50
SELECT student_id FROM DEC_TEST_SCORES t1
WHERE subject in ('数学', '语文') 
AND not EXISTS(
  SELECT 1 FROM DEC_TEST_SCORES t2
  WHERE t1.student_id = t2.student_id 
    AND 1 = CASE WHEN subject = '数学' AND score < 80 THEN 1 
                 WHEN subject = '语文' AND score < 50 THEN 1 
                 ELSE 0 END) 
GROUP BY student_id
having count(1) > 1;

-- Query the project_id which is exactly waiting at step 2 
-- there is an issue if B200 steps are both Completed
SELECT project_id FROM DEC_PROJECTS
GROUP BY project_id 
having count(*) = SUM(CASE 
  WHEN step_no <= 1 AND status = 'Completed' THEN 1 
  WHEN step_no > 1 AND status <> 'Completed' THEN 1 
  ELSE 0 END
);

-- query the cols that contains at lease one 9
SELECT * FROM DEC_ARRAY
WHERE 9 in (col1, col2, col3, col4, col5, col6, col7, col8, col9, col10);

-- query the arrname in which all the values are 1 (excluding the NULL value)
SELECT distinct arrname FROM DEC_ARRAYROW ta
WHERE not EXISTS (
  SELECT * FROM DEC_ARRAYROW tb
    WHERE ta.arrname = tb.arrname AND (tb.value is NULL OR tb.value <> 1)
);

-- this one got some problems for the CASE that there are only "1 AND NULL" in the table
SELECT arrname FROM DEC_ARRAYROW 
GROUP BY arrname
having MIN(value) = 1 AND MAX(value) = 1;

-- all primes in [2, 100]
SELECT distinct value FROM DEC_ARRAYROW 
WHERE value in (2, 3, 5, 7)
    OR value > 1
    AND value % 2 > 0
    AND value % 3 > 0
    AND value % 5 > 0
    AND value % 7 > 0
order by value;

-- OR:
SELECT distinct value FROM DEC_ARRAYROW A
WHERE value > 1 AND not EXISTS (
  SELECT * FROM DEC_ARRAYROW B
  WHERE B.value > 1
  AND B.value <= A.value / 2
  AND A.value % B.value = 0
)
order by value;
  
--check if missing seq
SELECT 'There are missing seq...' AS seq_gap
FROM DEC_SEQ  
having count(*) <> MAX(seq) - MIN(seq) + 1;  

--check those not-constant missing seqs
--the result doesn't cotains the missing seqs CASE such AS 9, 10, 11
--instead it only returns 9
SELECT seq + 1 AS 'StartMissingSeq' FROM DEC_SEQ
WHERE seq + 1 not in (SELECT seq FROM DEC_SEQ);

--Get the popular values 
SELECT score, count(*) AS max_cnt FROM DEC_TEST_SCORES  
GROUP BY score
having max_cnt >= (
SELECT MAX(cnt) FROM (
  SELECT count(*) AS cnt FROM DEC_TEST_SCORES 
  GROUP BY score
)T1);

--the value contains a NULL
SELECT arrname FROM DEC_ARRAYROW 
GROUP BY arrname
having count(*) > SUM(CASE WHEN value is null THEN 0 ELSE 1 END);

--1. the class which  75% students >=80
SELECT class FROM DEC_TEST_SCORES2
GROUP BY class
having count(*) <= SUM(CASE WHEN score >=80 THEN 1 ELSE 0 END) * 4 / 3 ;

--2. class socre >50 & M more than socre>50 & F 
SELECT class FROM DEC_TEST_SCORES2
GROUP BY class
having SUM(CASE WHEN score >=50 AND gender = 'M' THEN 1 ELSE 0 END) 
  > SUM(CASE WHEN score >=50 AND gender = 'F' THEN 1 ELSE 0 END) ;

--3. avg(all F scores)  > avg(all M scores)  
SELECT class FROM DEC_TEST_SCORES2 
GROUP BY class
having AVG(CASE WHEN gender = 'F' THEN score ELSE NULL END) > AVG(CASE WHEN gender = 'M' THEN score ELSE NULL END);

-- Query duplicated materials City
SELECT center FROM DEC_MATERIALS
GROUP BY center
having count(material) > count(distinct material);

SELECT center, 
  CASE WHEN count(material) > count(distinct material) THEN 'Duplicated Material' ELSE 'No' END AS duplicated
FROM DEC_MATERIALS
GROUP BY center;

-- which shop owns all the items
SELECT s.shop FROM DEC_SHOP_ITEMS s INNER JOIN DEC_ITEMS i
on s.item = i.item
GROUP BY s.shop
having count(s.item) = (SELECT count(item) FROM DEC_ITEMS);

-- which shop exactly owns the items (no more no less)
SELECT s.shop FROM DEC_SHOP_ITEMS s LEFT OUTER JOIN DEC_ITEMS i
on s.item = i.item 
GROUP BY s.shop
having count(s.item) = (SELECT count(item) FROM DEC_ITEMS)
   AND count(i.item) = (SELECT count(item) FROM DEC_ITEMS);

-- the college whose student all submit in September
SELECT dpt FROM (
  SELECT dpt, 
    CASE WHEN sbmt_date >= '2018-09-01' AND sbmt_date < '2018-10-01' THEN 1 ELSE 0 END AS sbmt_date_ind 
  FROM DEC_SUB) t1
GROUP BY dpt 
having count(*) = SUM(sbmt_date_ind);

--OR
SELECT dpt FROM DEC_SUB
GROUP BY dpt
having count(*) = SUM(CASE WHEN YEAR(sbmt_date) = 2018 AND MONTH(sbmt_date) = 9 THEN 1 ELSE 0 END);

-- list the my item count AND the diff count:
SELECT shop, count(item) AS my_item_cnt, (SELECT count(*) FROM DEC_ITEMS) - count(item) AS diff_cnt 
FROM (
  SELECT s.shop, i.item FROM DEC_SHOP_ITEMS s LEFT OUTER JOIN DEC_ITEMS i
  on s.item = i.item
) t1
GROUP BY shop ;

-- sales analytics with last year
SELECT S1.year, S1.sale AS current_sale, S2.sale AS last_year_sale, S1.sale - S2.sale
FROM DEC_SALE S1 LEFT OUTER JOIN DEC_SALE S2
on S1.year = S2.year + 1;

SELECT year, sale AS current_sale, 
  SUM(sale) OVER (order by year range between 1 preceding AND 1 preceding) AS last_year_sale
FROM DEC_SALE; 

-- Make sure you understand the difference of Range Between / Rows Between
SELECT year, sale AS current_sale, 
  SUM(sale) OVER (order by year rows between 1 preceding AND 1 preceding) AS last_year_sale
FROM DEC_SALE; 

SELECT year, last_year_sale, sale AS current_sale,
  CASE WHEN sale > last_year_sale THEN '↑'
  WHEN sale = last_year_sale THEN '→'
  ELSE '↓' END AS trENDing
FROM(  
  SELECT year, sale, 
    SUM(sale) OVER (order by year rows between 1 preceding AND 1 preceding) AS last_year_sale
  FROM DEC_SALE
)t1;

--the price > avg (price) of the same product type
SELECT * FROM DEC_PRODUCTS A
WHERE price > (SELECT avg(price)
  FROM DEC_PRODUCTS B
  WHERE A.product_type = B.product_type
  GROUP BY product_type
);

SELECT product_name, product_type, price, avg_price
FROM (
  SELECT product_name, product_type, price,
    avg(price) over (partition by product_type) AS avg_price  
  FROM DEC_PRODUCTS )TMP1
WHERE price > avg_price;

--query per page:
SELECT product_name, product_type, price, row_num, total_count FROM (
SELECT product_name, product_type, price,
    ROW_NUMBER() over(order by product_type, product_name) AS row_num,
    count(*) over () AS total_count
FROM DEC_PRODUCTS ) T1
WHERE row_num between 1 AND 5;

--check over booked reservations
SELECT * FROM DEC_RESERVATIONS A
WHERE EXISTS(
 SELECT * FROM DEC_RESERVATIONS B
 WHERE A.reserver <> B.reserver
   AND (A.start_date between B.start_date AND B.END_date
   OR A.END_date between  B.start_date AND B.END_date)
);

SELECT *
FROM (SELECT reserver, start_date, END_date, 
 MAX(start_date) over (order by start_date rows between 1 following AND 1 following) AS next_start_date,
 MAX(reserver) over (order by start_date rows between 1 following AND 1 following) AS next_reserver
FROM DEC_RESERVATIONS)T1
WHERE next_start_date between start_date AND END_date;

--check the avg amount of pre 2 AND current row
SELECT prc_date, prc_amt, 
  avg(prc_amt) over (order by prc_date rows between 2 preceding AND current row) AS avg
FROM DEC_ACCOUNTS;

--use join to implete the avg amout of of pre 2 AND current row
with acc AS ( 
SELECT (@row_number:=@row_number + 1) AS seq, t.prc_date, t.prc_amt
FROM DEC_ACCOUNTS t, (SELECT @row_number:=0) AS r)
---------define a temporary table with rownum AS above
SELECT alt.*, 
  CASE WHEN alt.amt2 is NULL THEN alt.amt1
  WHEN alt.amt3 is NULL THEN (alt.amt1 + alt.amt2)/2
  ELSE (alt.amt1 + alt.amt2 + alt.amt3)/3 END AS avg_amt
FROM (SELECT acc.seq, acc.prc_date, acc.prc_amt AS amt1, acc2.prc_amt AS amt2, acc3.prc_amt AS amt3
  FROM acc LEFT OUTER JOIN acc acc2
    on acc.seq = acc2.seq + 1
  LEFT OUTER JOIN acc acc3
   on acc.seq = acc3.seq +2
) alt;

--Another way to use the join to implete the avg amout of of pre 2 AND current row
SELECT prc_date, A1.prc_amt, (
  SELECT avg(prc_amt) FROM DEC_ACCOUNTS A2
  WHERE A1.prc_date >= A2.prc_date
    AND(
      SELECT count(*) FROM DEC_ACCOUNTS A3 
      WHERE A3.prc_date between A2.prc_date AND A1.prc_date) <=3) AS mvg_SUM
FROM DEC_ACCOUNTS A1
order by prc_date;

--student AND courses
SELECT t0.name
  ,(SELECT 'O' FROM DEC_STUDENT_COURSES t1 WHERE t0.name = t1.name AND course = 'SQL') AS 'SQL'
  ,(SELECT 'O' FROM DEC_STUDENT_COURSES t2 WHERE t0.name = t2.name AND course = 'UNIX') AS 'UNIX'
  ,(SELECT 'O' FROM DEC_STUDENT_COURSES t3 WHERE t0.name = t3.name AND course = 'Java') AS 'Java'
FROM (SELECT distinct name FROM DEC_STUDENT_COURSES) t0 ;

SELECT name, 
  CASE WHEN SUM(CASE WHEN course = 'SQL' THEN 1 ELSE NULL END) >= 1 THEN 'O' ELSE NULL END AS 'SQL',
  CASE WHEN SUM(CASE WHEN course = 'UNIX' THEN 1 ELSE NULL END) >= 1 THEN 'O' ELSE NULL END AS 'UNIX',
  CASE WHEN SUM(CASE WHEN course = 'Java' THEN 1 ELSE NULL END) >= 1 THEN 'O' ELSE NULL END AS 'Java'
FROM DEC_STUDENT_COURSES
GROUP BY name;

-- cols ==> rows
SELECT name, child_1 AS child FROM  DEC_PERSONNEL
union
SELECT name, child_2 AS child FROM  DEC_PERSONNEL
union
SELECT name, child_3 AS child FROM  DEC_PERSONNEL;

SELECT p.name, vc.child
FROM DEC_PERSONNEL p LEFT OUTER JOIN DEC_V_PERSONNEL vc
on vc.child in (p.child_1, p.child_2, p.child_3);

-- FULL OUTER JOIN -- mysql doesn't support it
/* SELECT COALESCE(a.id, b.id) AS id, a.name AS a_name, b.name AS b_name
FROM DEC_NAMEA a FULL OUTER JOIN DEC_NAMEB b
on a.id = b.id; */
-- use LEFT OUTER JOIN UNION right outer join to replace FULL OUTER JOIN
SELECT a.id AS id, a.name AS a_name, b.name AS b_name
FROM DEC_NAMEA a LEFT OUTER JOIN DEC_NAMEB b
on a.id = b.id
union
SELECT b.id AS id, a.name AS a_name, b.name AS b_name
FROM DEC_NAMEA a right outer join DEC_NAMEB b
on a.id = b.id;

--use below AS a Merge in MySQL
insert into DEC_NAMEA
SELECT id, name FROM DEC_NAMEB
  ON DUPLICATE KEY UPDATE DEC_NAMEA.name = DEC_NAMEB.name;
  
--check if two tables are the same.  change the "3" to which is reasonable
SELECT 
 CASE WHEN count(*) = 3 THEN 'A AND B are the same' ELSE 'NOT same' END 
FROM (SELECT  * FROM DEC_NAMEA   union 
     SELECT * FROM DEC_NAMEB) tmp;
 
--another method to check if two tables are the same
SELECT CASE WHEN count(*) = 0 THEN 'The same' ELSE 'NOT same' END AS result
FROM
((SELECT * FROM DEC_NAMEA UNION SELECT * FROM DEC_NAMEB)
EXCEPT  
(SELECT * FROM DEC_NAMEA INTERSECT SELECT * FROM DEC_NAMEB)) t1;

--check who have all the skills required in the course table
SELECT distinct emp FROM  DEC_EMP_SKILLS t1
WHERE NOT EXISTS (
  SELECT skill FROM DEC_COURSES
  except
  SELECT t2.skill FROM DEC_EMP_SKILLS t2
  WHERE t1.emp = t2.emp
);

--compare which supplier supplies the same parts 
SELECT s1.sup AS sup1, s2.sup AS sup2 
FROM DEC_SUP s1, DEC_SUP s2
WHERE s1.sup < s2.sup 
  AND s1.part = s2.part
GROUP BY s1.sup, s2.sup
having count(*) = (SELECT count(*) FROM DEC_SUP s3 WHERE s1.sup = s3.sup)
   AND count(*) = (SELECT count(*) FROM DEC_SUP s4 WHERE s2.sup = s4.sup);

--query AND search for the emp who hAS exactly the skill defined in DEC_COURSES
SELECT emp, 
CASE WHEN count(skill_e) = count(skill_c) AND count(skill_e) = (SELECT count(*) FROM DEC_COURSES) THEN 'Y' ELSE 'N' END AS result
FROM(
  SELECT emp, e.skill AS skill_e, c.skill AS skill_c 
  FROM DEC_EMP_SKILLS e LEFT OUTER JOIN  DEC_COURSES c
  on e.skill = c.skill) tmp
GROUP BY emp
having result = 'Y';

--the answer FROM the book regarding above questions:
SELECT emp FROM  DEC_EMP_SKILLS t1
WHERE NOT EXISTS (
  SELECT skill FROM DEC_COURSES
  except
  SELECT t2.skill FROM DEC_EMP_SKILLS t2
  WHERE t1.emp = t2.emp
)
GROUP BY emp
having count(*) = (SELECT count(*) FROM DEC_COURSES);

--another way to that
SELECT distinct emp FROM DEC_EMP_SKILLS t1
WHERE NOT EXISTS (
  SELECT skill FROM DEC_COURSES
  except
  SELECT t2.skill FROM DEC_EMP_SKILLS t2
  WHERE t1.emp = t2.emp
) 
AND NOT EXISTS (
  SELECT t2.skill FROM DEC_EMP_SKILLS t2
  WHERE t1.emp = t2.emp
  except
  SELECT skill FROM DEC_COURSES
);

--area of seats 
SELECT a.seat, '~', b.seat
FROM DEC_SEATS a, DEC_SEATS b
WHERE b.seat = a.seat + (3 - 1)
  AND NOT EXISTS (
    SELECT * FROM DEC_SEATS c
    WHERE c.seat between a.seat AND b.seat
      AND c.status <> ''
  );
  
SELECT seat, '~', END_seat
FROM (SELECT seat, MAX(seat) over (order by seat rows between 2 following AND 2 following) AS END_seat
  FROM DEC_SEATS 
  WHERE status = ''
)t1
WHERE END_seat = seat + 2;


update dec_doctor_info 
set region_name = COALESCE(
   (SELECT MAX(F2.region_name) FROM dec_doctor_info F2
   INNER JOIN dec_account_info A on F2.account_key= A.account_key
   WHERE F2.region_name <> ''
     AND F2.ta = dec_doctor_info.ta
     AND A.primary_parent_account_key = (
	  SELECT A2.primary_parent_account_key FROM dec_account_info A2
	  WHERE A2.account_key = dec_doctor_info.account_key
     )
   )
  , '-'
)
WHERE region_name = '';




UPDATE dec_doctor_info 
SET region_name = COALESCE(
   (SELECT MAX(F2.region_name) FROM 
   (SELECT * FROM dec_doctor_info) F2
   INNER JOIN dec_account_info A ON F2.account_key= A.account_key
   WHERE F2.region_name <> ''
     AND F2.ta = dec_doctor_info.ta
     AND A.primary_parent_account_key = (
      SELECT A2.primary_parent_account_key FROM dec_account_info A2
      WHERE A2.account_key = dec_doctor_info.account_key
     )
   )
  , '-')
WHERE region_name = '';


```

```
DROP TABLE IF EXISTS DEC_USER;

CREATE TABLE DEC_USER  ( 
  id INT PRIMARY KEY AUTO_INCREMENT,
  nickname VARCHAR(32) NOT NULL,
  age int,
  address VARCHAR(200) DEFAULT ''
);

INSERT INTO DEC_USER(nickname, age, address) VALUES ('Liubei', 34, 'Shu');
INSERT INTO DEC_USER(nickname, age, address) VALUES ('Guanyu', 32, 'Shu');
INSERT INTO DEC_USER(nickname, age, address) VALUES ('Zhangfei', 31, 'Shu');
INSERT INTO DEC_USER(nickname, age, address) VALUES ('Caocao', 35, 'Wei');
INSERT INTO DEC_USER(nickname, age, address) VALUES ('Zhangliao', 32, 'Wei');
INSERT INTO DEC_USER(nickname, address) VALUES ('Guojia', 'Wei');
----------------------------------------------------------------------------------------------------
DROP TABLE IF EXISTS DEC_ORDER;

CREATE TABLE DEC_ORDER (
  ID INT PRIMARY KEY AUTO_INCREMENT,
  PRODUCT VARCHAR (255) NOT NULL,
  PRICE DECIMAL NOT NULL,
  QUANTITY INT NOT NULL DEFAULT 1,
  USERID BIGINT NOT NULL
)  ;

INSERT INTO DEC_ORDER(PRODUCT, PRICE, USERID) VALUES('MAC BOOK PRO 2022', 9000.0, 1);
INSERT INTO DEC_ORDER(PRODUCT, PRICE, USERID) VALUES('THINKPAD T480', 7888.0, 2);
INSERT INTO DEC_ORDER(PRODUCT, PRICE, USERID) VALUES('iPhone 14 Max', 6999.0, 3);
INSERT INTO DEC_ORDER(PRODUCT, PRICE, USERID) VALUES('MAC BOOK PRO 2022', 9000.0, 4);
INSERT INTO DEC_ORDER(PRODUCT, PRICE, USERID) VALUES('THINKPAD T480', 7888.0, 5);
INSERT INTO DEC_ORDER(PRODUCT, PRICE, USERID) VALUES('iPhone 14 Max', 6999.0, 6);
INSERT INTO DEC_ORDER(PRODUCT, PRICE, USERID) VALUES('iPhone 14 Max', 6999.0, 7);
INSERT INTO DEC_ORDER(PRODUCT, PRICE, USERID) VALUES('U DISK 32GB', 169.0, 8);
INSERT INTO DEC_ORDER(PRODUCT, PRICE, USERID) VALUES('U DISK 64GB', 269.0, 9);
INSERT INTO DEC_ORDER(PRODUCT, PRICE, USERID) VALUES('U DISK 64GB', 269.0, 10);
----------------------------------------------------------------------------------------------------
DROP TABLE IF EXISTS dec_popu;

CREATE TABLE dec_popu (
  id INT PRIMARY KEY AUTO_INCREMENT,
  city VARCHAR (64) NOT NULL,
  gender VARCHAR(1) NOT NULL DEFAULT 'M',
  population INT NOT NULL DEFAULT 0
);

INSERT INTO dec_popu(city, gender, population) VALUES('贵阳市', 'M' , 26714);
INSERT INTO dec_popu(city, gender, population) VALUES('贵阳市', 'F' , 23134);
INSERT INTO dec_popu(city, gender, population) VALUES('六枝特区', 'M' , 3026);
INSERT INTO dec_popu(city, gender, population) VALUES('六枝特区', 'F' , 2926);
INSERT INTO dec_popu(city, gender, population) VALUES('德州市', 'M' , 23256);
INSERT INTO dec_popu(city, gender, population) VALUES('青岛市', 'M' , 24770);
INSERT INTO dec_popu(city, gender, population) VALUES('潍坊市', 'M' , 32005);
INSERT INTO dec_popu(city, gender, population) VALUES('潍坊市', 'F' , 12000);
INSERT INTO dec_popu(city, gender, population) VALUES('乐山市', 'M' , 19200);
INSERT INTO dec_popu(city, gender, population) VALUES('乐山市', 'F' , 10800);
----------------------------------------------------------------------------------------------------
DROP TABLE IF EXISTS dec_course;
CREATE TABLE dec_course (
  course_id INT PRIMARY KEY AUTO_INCREMENT,
  course_name VARCHAR (32) NOT NULL
);

INSERT INTO dec_course(course_name) VALUES('计算机基础');
INSERT INTO dec_course(course_name) VALUES('会计学');
INSERT INTO dec_course(course_name) VALUES('财务管理学');
INSERT INTO dec_course(course_name) VALUES('英语');

----------------------------------------------------------------------------------------------------
DROP TABLE IF EXISTS dec_course_schedule;

CREATE TABLE dec_course_schedule (
  id INT PRIMARY KEY AUTO_INCREMENT,
  course_id INT NOT NULL,
  schedule_month  VARCHAR(10)
);
INSERT INTO dec_course_schedule(course_id, schedule_month) VALUES(1, '2022-05');
INSERT INTO dec_course_schedule(course_id, schedule_month) VALUES(1, '2022-06');
INSERT INTO dec_course_schedule(course_id, schedule_month) VALUES(1, '2022-07');
INSERT INTO dec_course_schedule(course_id, schedule_month) VALUES(2, '2022-06');
INSERT INTO dec_course_schedule(course_id, schedule_month) VALUES(2, '2022-07');
INSERT INTO dec_course_schedule(course_id, schedule_month) VALUES(3, '2022-05');
INSERT INTO dec_course_schedule(course_id, schedule_month) VALUES(4, '2022-07');

----------------------------------------------------------------------------------------------------
DROP TABLE IF EXISTS dec_xyz;
CREATE TABLE dec_xyz (
  id INT PRIMARY KEY AUTO_INCREMENT,
  name VARCHAR (16) NOT NULL,
  x int,
  y int,
  z int
);

INSERT INTO dec_xyz VALUES('a', 1, 2, 3);
INSERT INTO dec_xyz VALUES('b', 5, 5, 2);
INSERT INTO dec_xyz VALUES('c', 4, 7, 1);
INSERT INTO dec_xyz VALUES('d', 3, 3, 8);

----------------------------------------------------------------------------------------------------
DROP TABLE IF EXISTS DEC_SERVER_LOAD;
CREATE TABLE DEC_SERVER_LOAD (
  server VARCHAR (4) NOT NULL,
  sample_date date NOT NULL,
  loads int NOT NULL default 0
);

insert into DEC_SERVER_LOAD(server, sample_date, loads) values ('A', '2022-05-01', 1000);
insert into DEC_SERVER_LOAD(server, sample_date, loads) values ('A', '2022-05-02', 1200);
insert into DEC_SERVER_LOAD(server, sample_date, loads) values ('A', '2022-05-03', 1300);
insert into DEC_SERVER_LOAD(server, sample_date, loads) values ('A', '2022-05-04', 900);
insert into DEC_SERVER_LOAD(server, sample_date, loads) values ('A', '2022-05-05', 1220);
insert into DEC_SERVER_LOAD(server, sample_date, loads) values ('B', '2022-05-01', 1100);
insert into DEC_SERVER_LOAD(server, sample_date, loads) values ('B', '2022-05-02', 1200);
insert into DEC_SERVER_LOAD(server, sample_date, loads) values ('B', '2022-05-06', 1500);
insert into DEC_SERVER_LOAD(server, sample_date, loads) values ('B', '2022-05-07', 2000);
insert into DEC_SERVER_LOAD(server, sample_date, loads) values ('B', '2022-05-12', 1000);
insert into DEC_SERVER_LOAD(server, sample_date, loads) values ('C', '2022-05-01', 2000);
insert into DEC_SERVER_LOAD(server, sample_date, loads) values ('C', '2022-05-03', 1300);
insert into DEC_SERVER_LOAD(server, sample_date, loads) values ('C', '2022-05-04', 1200);
insert into DEC_SERVER_LOAD(server, sample_date, loads) values ('C', '2022-05-05', 1600);

----------------------------------------------------------------------------------------------------
DROP TABLE IF EXISTS dec_product;
CREATE TABLE dec_product (
  id INT PRIMARY KEY AUTO_INCREMENT,
  product_name VARCHAR(32) not null,
  price DECIMAL(10,2),
  remarks VARCHAR(32) default ''
);

insert into dec_product(product_name, price) values('Apple', 7.5);
insert into dec_product(product_name, price) values('Watermelon', 2);
insert into dec_product(product_name, price) values('Banana', 5);
insert into dec_product(product_name, price) values('Apple', 7.5);
insert into dec_product(product_name, price) values('Apple', 7.5);
insert into dec_product(product_name, price) values('Banana', 5);
insert into dec_product(product_name, price) values('Apple', 8);
insert into dec_product(product_name, price) values('Apple', 8.5);
insert into dec_product(product_name, price) values('Watermelon', 2.2);
insert into dec_product(product_name, price) values('Grape', 7.5);
insert into dec_product(product_name, price) values('Orange', 12);
insert into dec_product(product_name, price) values('Carrot', 2);
insert into dec_product(product_name, price) values('Tomato', 1);
insert into dec_product(product_name, price) values('Cherry', 20);

----------------------------------------------------------------------------------------------------
DROP TABLE IF EXISTS DEC_MEETING;
CREATE TABLE DEC_MEETING (
  meeting_id char(4) not null,
  person VARCHAR(32) not null
);

insert into DEC_MEETING values('M1', 'Yi Teng');
insert into DEC_MEETING values('M1', 'Shui Dao');
insert into DEC_MEETING values('M1', 'Hu Dong');
insert into DEC_MEETING values('M2', 'Yi Teng');
insert into DEC_MEETING values('M2', 'Gong Tian');
insert into DEC_MEETING values('M3', 'Shui Dao');
insert into DEC_MEETING values('M3', 'Hu Dong');
insert into DEC_MEETING values('M3', 'Gong Tian');
----------------------------------------------------------------------------------------------------
DROP TABLE IF EXISTS DEC_TEST_SCORES;
CREATE TABLE DEC_TEST_SCORES (
  student_id INT NOT NULL,
  subject VARCHAR (16) NOT NULL,
  score int
);

INSERT into DEC_TEST_SCORES values (100, '数学', 100);
INSERT into DEC_TEST_SCORES values (100, '语文', 80);
INSERT into DEC_TEST_SCORES values (100, '理化', 80);
INSERT into DEC_TEST_SCORES values (200, '数学', 80);
INSERT into DEC_TEST_SCORES values (200, '语文', 95);
INSERT into DEC_TEST_SCORES values (300, '数学', 40);
INSERT into DEC_TEST_SCORES values (300, '语文', 90);
INSERT into DEC_TEST_SCORES values (300, '社会', 55);
INSERT into DEC_TEST_SCORES values (400, '数学', 80);
----------------------------------------------------------------------------------------------------
DROP TABLE IF EXISTS DEC_PROJECTS;
CREATE TABLE DEC_PROJECTS (
  project_id char(10) NOT NULL,
  step_no int NOT NULL,
  status char(10)
);

insert into DEC_PROJECTS values ('AA100', 0, 'Completed');
insert into DEC_PROJECTS values ('AA100', 1, 'Waiting');
insert into DEC_PROJECTS values ('AA100', 2, 'Waiting');
insert into DEC_PROJECTS values ('B200', 0, 'Waiting');
insert into DEC_PROJECTS values ('B200', 1, 'Waiting');
insert into DEC_PROJECTS values ('CS300', 0, 'Completed');
insert into DEC_PROJECTS values ('CS300', 1, 'Completed');
insert into DEC_PROJECTS values ('CS300', 2, 'Waiting');
insert into DEC_PROJECTS values ('CS300', 3, 'Waiting');
insert into DEC_PROJECTS values ('DY400', 0, 'Completed');
insert into DEC_PROJECTS values ('DY400', 1, 'Completed');
insert into DEC_PROJECTS values ('DY400', 2, 'Completed'); 
----------------------------------------------------------------------------------------------------
DROP TABLE IF EXISTS DEC_ARRAY;
CREATE TABLE DEC_ARRAY (
  name char(10) NOT NULL,
  col1 int NOT NULL default 0,
  col2 int NOT NULL default 0,
  col3 int NOT NULL default 0,
  col4 int NOT NULL default 0,
  col5 int NOT NULL default 0,
  col6 int NOT NULL default 0,
  col7 int NOT NULL default 0,
  col8 int NOT NULL default 0,
  col9 int NOT NULL default 0,
  col10 int NOT NULL default 0
) COLLATE utf8mb4_general_ci;

insert into DEC_ARRAY(name) values ('A');
insert into DEC_ARRAY(name, col1) values ('B', 3);
insert into DEC_ARRAY(name, col1, col2, col3, col4, col5, col6, col7, col8, col9, col10) values ('C', 1, 1, 1, 1, 1, 1, 1, 1, 1, 1);
insert into DEC_ARRAY(name, col3) values ('D', 9);
insert into DEC_ARRAY(name, col2, col4, col5, col8) values ('E', 3, 1, 9, 9);

----------------------------------------------------------------------------------------------------
DROP TABLE IF EXISTS DEC_ARRAYROW;
CREATE TABLE DEC_ARRAYROW (
  arrname char(10) NOT NULL,
  i int NOT NULL default 0,
  value int
);


insert into DEC_ARRAYROW(arrname, i) values('A', 1);
insert into DEC_ARRAYROW(arrname, i) values('A', 2);
insert into DEC_ARRAYROW(arrname, i) values('A', 3);
insert into DEC_ARRAYROW(arrname, i) values('A', 4);
insert into DEC_ARRAYROW(arrname, i, value) values('B', 1, 3);
insert into DEC_ARRAYROW(arrname, i) values('B', 2);
insert into DEC_ARRAYROW(arrname, i) values('B', 3);
insert into DEC_ARRAYROW(arrname, i) values('B', 4);
insert into DEC_ARRAYROW(arrname, i) values('B', 5);
insert into DEC_ARRAYROW(arrname, i) values('B', 6);
insert into DEC_ARRAYROW(arrname, i, value) values('C', 1, 1);
insert into DEC_ARRAYROW(arrname, i, value) values('C', 2, 1);
insert into DEC_ARRAYROW(arrname, i, value) values('C', 3, 1);
insert into DEC_ARRAYROW(arrname, i, value) values('C', 4, 1);
insert into DEC_ARRAYROW(arrname, i, value) values('C', 5, 1);
insert into DEC_ARRAYROW(arrname, i, value) values('C', 6, 1);
insert into DEC_ARRAYROW(arrname, i, value) values('C', 7, 1);
insert into DEC_ARRAYROW(arrname, i, value) values('C', 8, 1); 
insert into DEC_ARRAYROW(arrname, i, value) values('D', 1, 1);
insert into DEC_ARRAYROW(arrname, i, value) values('D', 2, 1);
insert into DEC_ARRAYROW(arrname, i, value) values('D', 3, 0);
insert into DEC_ARRAYROW(arrname, i) values('D', 4);
insert into DEC_ARRAYROW(arrname, i) values('D', 5);
insert into DEC_ARRAYROW(arrname, i, value) values('E', 1, 1);
insert into DEC_ARRAYROW(arrname, i) values('E', 2);
-- below are for primes
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 1, 1);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 2, 2);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 3, 3);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 4, 4);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 5, 5);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 6, 6);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 7, 7);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 8, 8);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 9, 9);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 10, 10);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 11, 11);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 12, 12);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 13, 13);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 14, 14);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 15, 15);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 16, 16);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 17, 17);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 18, 18);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 19, 19);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 20, 20);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 21, 21);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 22, 22);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 23, 23);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 24, 24);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 25, 25);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 26, 26);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 27, 27);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 28, 28);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 29, 29);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 30, 30);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 31, 31);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 32, 32);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 33, 33);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 34, 34);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 35, 35);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 36, 36);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 37, 37);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 38, 38);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 39, 39);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 40, 40);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 41, 41);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 42, 42);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 43, 43);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 44, 44);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 45, 45);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 46, 46);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 47, 47);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 48, 48);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 49, 49);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 50, 50);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 51, 51);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 52, 52);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 53, 53);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 54, 54);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 55, 55);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 56, 56);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 57, 57);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 58, 58);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 59, 59);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 60, 60);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 61, 61);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 62, 62);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 63, 63);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 64, 64);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 65, 65);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 66, 66);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 67, 67);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 68, 68);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 69, 69);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 70, 70);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 71, 71);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 72, 72);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 73, 73);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 74, 74);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 75, 75);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 76, 76);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 77, 77);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 78, 78);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 79, 79);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 80, 80);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 81, 81);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 82, 82);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 83, 83);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 84, 84);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 85, 85);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 86, 86);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 87, 87);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 88, 88);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 89, 89);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 90, 90);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 91, 91);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 92, 92);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 93, 93);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 94, 94);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 95, 95);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 96, 96);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 97, 97);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 98, 98);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 99, 99);
insert into DEC_ARRAYROW(arrname, i, value) values('Ints', 100, 100);
----------------------------------------------------------------------------------------------------
DROP TABLE IF EXISTS DEC_SEQ;
CREATE TABLE DEC_SEQ (
  seq int not null,
  name VARCHAR(16) not null default ''
);

--another way to insert 100 integers 
INSERT INTO DEC_SEQ (seq)
SELECT 1 + ones.id + 10 * tens.id AS number
FROM (SELECT 0 AS id UNION ALL SELECT 1 UNION ALL SELECT 2 UNION ALL SELECT 3 UNION ALL SELECT 4 UNION ALL SELECT 5 UNION ALL SELECT 6 UNION ALL SELECT 7 UNION ALL SELECT 8 UNION ALL SELECT 9) ones
CROSS JOIN (SELECT 0 AS id UNION ALL SELECT 1 UNION ALL SELECT 2 UNION ALL SELECT 3 UNION ALL SELECT 4 UNION ALL SELECT 5 UNION ALL SELECT 6 UNION ALL SELECT 7 UNION ALL SELECT 8 UNION ALL SELECT 9) tens 
WHERE  1 + ones.id + 10 * tens.id <= 100;

DELETE FROM DEC_SEQ; 

insert into DEC_SEQ values (1, 'Marry');
insert into DEC_SEQ values (2, 'Tom');
insert into DEC_SEQ values (3, 'Andy');
insert into DEC_SEQ values (4, 'John');
insert into DEC_SEQ values (6, 'Michael');
insert into DEC_SEQ values (7, 'Simon');
insert into DEC_SEQ values (8, 'Tony');
insert into DEC_SEQ values (12, 'Tommy');

----------------------------------------------------------------------------------------------------
DROP TABLE IF EXISTS DEC_TEST_SCORES2;
CREATE TABLE DEC_TEST_SCORES2 (
  student_id char(4) NOT NULL,  
  class char(4), 
  gender char(1), 
  score int
);

insert into DEC_TEST_SCORES2 values ('001', 'A', 'M', 100);
insert into DEC_TEST_SCORES2 values ('002', 'A', 'F', 100);
insert into DEC_TEST_SCORES2 values ('003', 'A', 'F', 49);
insert into DEC_TEST_SCORES2 values ('004', 'A', 'M', 30);
insert into DEC_TEST_SCORES2 values ('005', 'B', 'F', 100);
insert into DEC_TEST_SCORES2 values ('006', 'B', 'M', 92);
insert into DEC_TEST_SCORES2 values ('007', 'B', 'M', 80);
insert into DEC_TEST_SCORES2 values ('008', 'B', 'M', 80);
insert into DEC_TEST_SCORES2 values ('009', 'B', 'F', 10);
insert into DEC_TEST_SCORES2 values ('010', 'C', 'M', 92);
insert into DEC_TEST_SCORES2 values ('011', 'C', 'M', 80);
insert into DEC_TEST_SCORES2 values ('012', 'C', 'F', 21);
insert into DEC_TEST_SCORES2 values ('013', 'D', 'F', 100);
insert into DEC_TEST_SCORES2 values ('014', 'D', 'F', 0);
insert into DEC_TEST_SCORES2 values ('015', 'D', 'F', 0);

----------------------------------------------------------------------------------------------------
DROP TABLE IF EXISTS DEC_MATERIALS;
CREATE TABLE DEC_MATERIALS(
  center VARCHAR(16) not null,
  in_date date, 
  material VARCHAR(4)
);

insert into DEC_MATERIALS values ('Beijing', '2018-04-01', '锡');
insert into DEC_MATERIALS values ('Beijing', '2018-04-12', '锌');
insert into DEC_MATERIALS values ('Beijing', '2018-05-17', '铝');
insert into DEC_MATERIALS values ('Beijing', '2018-05-20', '锌');
insert into DEC_MATERIALS values ('Shanghai', '2018-04-20', '铜');
insert into DEC_MATERIALS values ('Shanghai', '2018-04-22', '镍');
insert into DEC_MATERIALS values ('Shanghai', '2018-04-29', '铅');
insert into DEC_MATERIALS values ('Tianjin', '2018-03-15', '钛');
insert into DEC_MATERIALS values ('Tianjin', '2018-04-01', '钢');
insert into DEC_MATERIALS values ('Tianjin', '2018-04-24', '钢');
insert into DEC_MATERIALS values ('Tianjin', '2018-05-02', '镁');
insert into DEC_MATERIALS values ('Tianjin', '2018-05-10', '钛');
insert into DEC_MATERIALS values ('Dalian', '2018-05-10', '锌');
insert into DEC_MATERIALS values ('Dalian', '2018-05-28', '锡');


DROP TABLE IF EXISTS DEC_ITEMS;
CREATE TABLE DEC_ITEMS(
  item VARCHAR(16) not null  
);

insert into DEC_ITEMS values ('啤酒');
insert into DEC_ITEMS values ('纸尿裤');
insert into DEC_ITEMS values ('自行车');

DROP TABLE IF EXISTS DEC_SHOP_ITEMS;
CREATE TABLE DEC_SHOP_ITEMS(
  shop VARCHAR(8) not null,
  item VARCHAR(16)   
);

insert into DEC_SHOP_ITEMS values ('A', '啤酒'); 
insert into DEC_SHOP_ITEMS values ('A', '纸尿裤'); 
insert into DEC_SHOP_ITEMS values ('A', '自行车'); 
insert into DEC_SHOP_ITEMS values ('A', '漫画书'); 
insert into DEC_SHOP_ITEMS values ('B', '啤酒');
insert into DEC_SHOP_ITEMS values ('B', '纸尿裤'); 
insert into DEC_SHOP_ITEMS values ('B', '自行车'); 
insert into DEC_SHOP_ITEMS values ('C', '电视'); 
insert into DEC_SHOP_ITEMS values ('C', '纸尿裤'); 
insert into DEC_SHOP_ITEMS values ('C', '自行车'); 
insert into DEC_SHOP_ITEMS values ('D', '台灯'); 
insert into DEC_SHOP_ITEMS values ('D', '牙膏'); 
----------------------------------------------------------------------------------------------------
DROP TABLE IF EXISTS DEC_SUB;
CREATE TABLE DEC_SUB (
  student_id char(4) PRIMARY KEY,
  dpt VARCHAR(32) not null, 
  sbmt_date date 
);

insert into DEC_SUB values('100', '理学院', '2018-10-01');
insert into DEC_SUB values('101', '理学院', '2018-09-22');
insert into DEC_SUB(student_id, dpt) values('102', '文学院');
insert into DEC_SUB values('103', '文学院', '2018-09-10');
insert into DEC_SUB values('200', '文学院', '2018-09-22'); 
insert into DEC_SUB(student_id, dpt) values('201', '工学院');
insert into DEC_SUB values('202', '经济学院', '2018-09-25');

----------------------------------------------------------------------------------------------------
DROP TABLE IF EXISTS DEC_SALE;
CREATE TABLE DEC_SALE (
  year int,
  sale int
);

insert into DEC_SALE values(1990, 50);
insert into DEC_SALE values(1991, 51);
insert into DEC_SALE values(1992, 52);
insert into DEC_SALE values(1993, 52);
insert into DEC_SALE values(1994, 50);
insert into DEC_SALE values(1995, 50);
insert into DEC_SALE values(1996, 49);
insert into DEC_SALE values(1997, 55);

----------------------------------------------------------------------------------------------------
DROP TABLE IF EXISTS DEC_PRODUCTS;
CREATE TABLE DEC_PRODUCTS (
  product_id char(4),
  product_name VARCHAR(32),
  product_type VARCHAR(16),  
  price DECIMAL(10,2)
);

insert into DEC_PRODUCTS values('0001', 'T-shirt', 'Clothes', 50);
insert into DEC_PRODUCTS values('0002', 'Printer', 'Office', 800);
insert into DEC_PRODUCTS values('0003', 'Sports shirt', 'Clothes', 120);
insert into DEC_PRODUCTS values('0004', 'Knife', 'Kitchen', 69);
insert into DEC_PRODUCTS values('0005', 'Pot', 'Kitchen', 339);
insert into DEC_PRODUCTS values('0006', 'Chopsticks', 'Kitchen', 16);
insert into DEC_PRODUCTS values('0007', 'Board', 'Kitchen', 88);
insert into DEC_PRODUCTS values('0008', 'Pen', 'Office', 2);
----------------------------------------------------------------------------------------------------
DROP TABLE IF EXISTS DEC_RESERVATIONS;
CREATE TABLE DEC_RESERVATIONS (
  reserver char(16) not null,
  start_date DATE,
  END_date DATE
);

insert into DEC_RESERVATIONS values ('Zhang', '2018-10-26', '2018-10-27');
insert into DEC_RESERVATIONS values ('Wang', '2018-10-28', '2018-10-31');
insert into DEC_RESERVATIONS values ('Li', '2018-10-31', '2018-11-01');
insert into DEC_RESERVATIONS values ('Zhao', '2018-11-03', '2018-11-04');
insert into DEC_RESERVATIONS values ('Qian', '2018-11-03', '2018-11-05');
insert into DEC_RESERVATIONS values ('Sun', '2018-11-06', '2018-11-06');
----------------------------------------------------------------------------------------------------
DROP TABLE IF EXISTS DEC_ACCOUNTS;
CREATE TABLE DEC_ACCOUNTS (
  prc_date DATE,
  prc_amt Decimal(10,2)
);

insert into DEC_ACCOUNTS values ('2018-10-26', 100);
insert into DEC_ACCOUNTS values ('2018-10-28', 200);
insert into DEC_ACCOUNTS values ('2018-10-31', 300);
insert into DEC_ACCOUNTS values ('2018-11-03', 400);
insert into DEC_ACCOUNTS values ('2018-11-04', -500);
insert into DEC_ACCOUNTS values ('2018-11-06', 600);
insert into DEC_ACCOUNTS values ('2018-11-11', 700);

----------------------------------------------------------------------------------------------------
DROP TABLE IF EXISTS DEC_STUDENT_COURSES;
CREATE TABLE DEC_STUDENT_COURSES (
  name VARCHAR(32),
  course VARCHAR(32)
);

INSERT into DEC_STUDENT_COURSES values ('赤井', 'SQL');
INSERT into DEC_STUDENT_COURSES values ('赤井', 'UNIX');
INSERT into DEC_STUDENT_COURSES values ('铃木', 'SQL');
INSERT into DEC_STUDENT_COURSES values ('工藤', 'SQL');
INSERT into DEC_STUDENT_COURSES values ('工藤', 'Java');
INSERT into DEC_STUDENT_COURSES values ('吉田', 'UNIX');
INSERT into DEC_STUDENT_COURSES values ('渡边', 'SQL');

----------------------------------------------------------------------------------------------------
DROP TABLE IF EXISTS DEC_PERSONNEL;
CREATE TABLE DEC_PERSONNEL (
  name VARCHAR(32),
  child_1 VARCHAR(32),
  child_2 VARCHAR(32),
  child_3 VARCHAR(32)
);
insert into DEC_PERSONNEL values ('赤井','1 lang', '2 lang', '3 lang');
insert into DEC_PERSONNEL values ('工藤', 'chun zi', 'xia zi', NULL);
insert into DEC_PERSONNEL values ('铃木', 'dong dong', NULl , NULL);
insert into DEC_PERSONNEL values ('吉田', NULL, NULL, NULL);

DROP view if EXISTS DEC_V_PERSONNEL;
create view DEC_V_PERSONNEL(child) AS 
  SELECT chd FROM(
  SELECT child_1 AS chd FROM  DEC_PERSONNEL
  union
  SELECT child_2 AS chd FROM  DEC_PERSONNEL
  union
  SELECT child_3 AS chd FROM  DEC_PERSONNEL
  ) t 
  WHERE t.chd is not null;

----------------------------------------------------------------------------------------------------
DROP TABLE IF EXISTS DEC_NAMEA;
CREATE TABLE DEC_NAMEA (
  id int PRIMARY KEY,
  name VARCHAR(32)
);
DROP TABLE IF EXISTS DEC_NAMEB;
CREATE TABLE DEC_NAMEB (
  id int PRIMARY KEY,
  name VARCHAR(32)
);
insert into DEC_NAMEA values(1, '田中');
insert into DEC_NAMEA values(2, '铃木');
insert into DEC_NAMEA values(3, '伊集院');
insert into DEC_NAMEB values(1, '田中');
insert into DEC_NAMEB values(2, '铃木New');
insert into DEC_NAMEB values(4, '西园寺');

----------------------------------------------------------------------------------------------------
DROP TABLE IF EXISTS DEC_COURSES;
CREATE TABLE DEC_COURSES (
  skill VARCHAR(32)
);

insert into DEC_COURSES values ('Oracle');
insert into DEC_COURSES values ('UNIX');
insert into DEC_COURSES values ('Java');

DROP TABLE IF EXISTS DEC_EMP_SKILLS;
CREATE TABLE DEC_EMP_SKILLS (
  emp VARCHAR(32), 
  skill VARCHAR(32)
);
insert into DEC_EMP_SKILLS values('向天', 'Oracle');
insert into DEC_EMP_SKILLS values('向天', 'UNIX');
insert into DEC_EMP_SKILLS values('向天', 'Java');
insert into DEC_EMP_SKILLS values('向天', 'MySQL');
insert into DEC_EMP_SKILLS values('神奇', 'Oracle');
insert into DEC_EMP_SKILLS values('神奇', 'UNIX');
insert into DEC_EMP_SKILLS values('神奇', 'Java');
insert into DEC_EMP_SKILLS values('神奇', 'C++');
insert into DEC_EMP_SKILLS values('平井', 'UNIX');
insert into DEC_EMP_SKILLS values('平井', 'Java');
insert into DEC_EMP_SKILLS values('平井', 'C++');
insert into DEC_EMP_SKILLS values('平井', 'Spark');
insert into DEC_EMP_SKILLS values('平井', 'Mainframe');
insert into DEC_EMP_SKILLS values('平井', 'NET');
insert into DEC_EMP_SKILLS values('若填部', 'Perl');
insert into DEC_EMP_SKILLS values('都来', 'Oracle');
insert into DEC_EMP_SKILLS values('都来', 'Java');
insert into DEC_EMP_SKILLS values('都来', 'UNIX');
insert into DEC_EMP_SKILLS values('一经为', 'UNIX');

----------------------------------------------------------------------------------------------------
DROP TABLE IF EXISTS DEC_SUP;
CREATE TABLE DEC_SUP (
  sup VARCHAR(16),
  part VARCHAR(32)
);
insert into DEC_SUP values ('A', '螺丝');
insert into DEC_SUP values ('A', '螺母');
insert into DEC_SUP values ('A', '管子');
insert into DEC_SUP values ('B', '螺丝');
insert into DEC_SUP values ('B', '螺母');
insert into DEC_SUP values ('C', '螺丝');
insert into DEC_SUP values ('C', '螺母');
insert into DEC_SUP values ('C', '管子');
insert into DEC_SUP values ('D', '螺丝');
insert into DEC_SUP values ('D', '螺母');
insert into DEC_SUP values ('E', '保险丝');
insert into DEC_SUP values ('E', '螺母');
insert into DEC_SUP values ('E', '管子');
insert into DEC_SUP values ('F', '保险丝');
----------------------------------------------------------------------------------------------------
DROP TABLE IF EXISTS DEC_DIGITS;
CREATE TABLE DEC_DIGITS (
  digit INT
);

insert into DEC_DIGITS values (0);
insert into DEC_DIGITS values (1);
insert into DEC_DIGITS values (2);
insert into DEC_DIGITS values (3);
insert into DEC_DIGITS values (4);
insert into DEC_DIGITS values (5);
insert into DEC_DIGITS values (6);
insert into DEC_DIGITS values (7);
insert into DEC_DIGITS values (8);
insert into DEC_DIGITS values (9);

DROP VIEW if EXISTS Sequence;

CREATE VIEW Sequence(seq) AS
SELECT d1.digit + d2.digit * 10 + d3.digit * 100
FROM DEC_DIGITS d1
 CROSS JOIN DEC_DIGITS d2
 CROSS JOIN DEC_DIGITS d3;
----------------------------------------------------------------------------------------------------
DROP TABLE IF EXISTS DEC_SEATS;
CREATE TABLE DEC_SEATS (
  seat INT,
  line_id char(1),
  status VARCHAR(16)
);

insert into DEC_SEATS values(1, 'A', 'Reserved');
insert into DEC_SEATS values(2, 'A', 'Reserved');
insert into DEC_SEATS values(3, 'A', '');
insert into DEC_SEATS values(4, 'A', '');
insert into DEC_SEATS values(5, 'A', '');
insert into DEC_SEATS values(6, 'B', 'Reserved');
insert into DEC_SEATS values(7, 'B', '');
insert into DEC_SEATS values(8, 'B', '');
insert into DEC_SEATS values(9, 'B', '');
insert into DEC_SEATS values(10, 'B', '');
insert into DEC_SEATS values(11, 'C', '');
insert into DEC_SEATS values(12, 'C', 'Reserved');
insert into DEC_SEATS values(13, 'C', 'Reserved');
insert into DEC_SEATS values(14, 'C', '');
insert into DEC_SEATS values(15, 'C', '');
----------------------------------------------------------------------------------------------------
DROP TABLE IF EXISTS dec_doctor_info;
CREATE TABLE dec_doctor_info (
  account_key INT,
  chnta char(8),
  region_name VARCHAR(16)
);

INSERT into dec_doctor_info values(1, 'tt', 'XXX-1');
INSERT into dec_doctor_info values(2, 'tt', '');
INSERT into dec_doctor_info values(3, 'tt', '');
INSERT into dec_doctor_info values(4, 'ta', 'UKKK-2');

DROP TABLE IF EXISTS dec_account_info;
CREATE TABLE dec_account_info (
  account_key INT,
  primary_parent_account_key INT  
);
insert into dec_account_info values(1, 1000);
insert into dec_account_info values(2, 1000);
insert into dec_account_info values(3, 2000);
insert into dec_account_info values(4, 1000);


```